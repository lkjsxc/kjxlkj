# Wave 4 Audit — Operator-Motion, Visual, Marks, Registers, Search

Date: 2026-02-10

## Requirement IDs Covered

- REQ-OP-01: Operator+motion composition (d{motion}, c{motion}, y{motion})
- REQ-OP-02: Doubled operators (dd, cc, yy, >>, <<, ==)
- REQ-OP-03: Count multiplication ([count]op[count]motion)
- REQ-VIS-01: Visual char selection with motions
- REQ-VIS-02: Visual line selection with motions
- REQ-VIS-03: Operators in visual mode (d, c, y, >, <)
- REQ-VIS-04: Visual `o` command (swap anchor/cursor)
- REQ-MARK-01: Set marks (m{char})
- REQ-MARK-02: Jump to marks ('{char}, `{char})
- REQ-REG-01: Register prefix ("{char})
- REQ-SEARCH-01: Search navigation (n/N)
- REQ-PREFIX-01: g-prefix (gg)
- REQ-PREFIX-02: z-prefix (zz, zt, zb)

## Files Created

- `op_pending.rs` — operator-pending mode dispatch (166 lines)
- `editing_ops_ranges.rs` — charwise/linewise operator application (181 lines)
- `visual_ops.rs` — visual mode dispatch (130 lines)
- `editor_search_marks.rs` — search/mark/register actions (120 lines)
- `op_pending_tests.rs` — 8 tests
- `visual_ops_tests.rs` — 9 tests
- `editor_actions_tests.rs` — 8 tests

## Files Modified

- `dispatch.rs` — restructured with unified `pending` prefix, added `take_count()` and `has_pending()`
- `transition.rs` — visual_transition uses current visual kind for toggle behavior
- `editor.rs` — added visual_anchor, op_count, motion_count, g_prefix, pending_register
- `editor_modes.rs` — wired OperatorPending/Visual dispatch, pending prefix bypass
- `editor_actions.rs` — split out search/mark/register to editor_search_marks.rs
- `lib.rs` — added new module declarations

## Mismatches Closed

| ID | Mismatch | Evidence |
|---|---|---|
| LIM-OPMOTION-01 | No operator+motion composition | `test_dd_deletes_line`, `test_dw_deletes_word`, `test_count_operator_motion` |
| LIM-VISUAL-01 | No visual selection | `test_visual_d_deletes_selection`, `test_visual_line_mode`, `test_visual_o_swaps_anchor` |
| LIM-MARKS-01 | No mark navigation | `test_set_and_jump_mark`, `test_jump_mark_line` |
| LIM-TEXTMANIP-01 | No indent/dedent | `test_indent_lines_range`, `test_dedent_lines_range` |

## Deferred

| Item | Rationale | Next Action |
|---|---|---|
| Text objects (iw, aw, ip, ap) | Requires text object range resolution | Wire TextObject resolution in op_pending |
| f/t/F/T motions | Single-char find motions | Add to op_pending motion dispatch |
| Visual block mode operations | Block mode needs column-based selection | Implement in visual_ops |
| Register consumption in yank/delete/put | "x prefix sets register but not yet consumed | Wire pending_register into yank/delete/put |
| Visual highlighting in render | Selection needs to be rendered with highlights | Wire visual_selection into snapshot |
| Dot repeat | Needs action recording | Implement repeat buffer |

## Verification

```
cargo build         — clean
cargo test          — 131 tests, 0 failures
cargo clippy        — 0 warnings
cargo fmt --check   — clean
max file size       — 199 lines (editor_modes.rs, session.rs)
```
