# Wave 5 Audit — 2026-02-10

Back: [/docs/log/audits/README.md](/docs/log/audits/README.md)

## Scope

- Macro recording/playback (LIM-MACROS-01)
- Command-line Tab completion (LIM-CMDCOMPL-01)
- Pattern-based / mark-based ranges (LIM-RANGEPATTERN-01)
- Editor options system (LIM-CONFIG-01)

## New Source Files

| File | Lines | Purpose |
|---|---|---|
| `macros.rs` | 73 | Macro recording/playback methods |
| `options.rs` | 158 | OptionStore, parse_set_command |
| `cmdline_completion.rs` | 102 | Tab completion for ex commands |
| `cmdline_dispatch.rs` | 59 | Command-line key dispatch (split) |
| `ex_parse_ranges.rs` | 153 | Rich range parsing with patterns/marks |
| `macros_tests.rs` | 99 | Macro tests (6 tests) |
| `options_tests.rs` | 79 | Options tests (8 tests) |
| `completion_range_tests.rs` | 130 | Completion + range tests (8 tests) |

## Modified Files

| File | Change |
|---|---|
| `editor.rs` | Added recording_macro, macro_buffer, macro_store, last_macro, options fields |
| `editor_modes.rs` | Macro intercept in handle_key, Command→Normal executes cmdline, split out dispatch_command_key |
| `editor_actions.rs` | Handle StartRecording, StopRecording, PlayMacro |
| `dispatch.rs` | Added q and @ as pending prefixes |
| `cmdline.rs` | Added CompletionState field |
| `ex_dispatch.rs` | Switched to parse_range_ctx with buffer/marks context, added :set handler |
| `ex_scripting.rs` | Added handle_set_command |
| `ex_parse.rs` | Made parse_offset public |
| `lib.rs` | Added 8 new modules |

## Verification

- `cargo build`: clean
- `cargo test`: 153 tests, 0 failures (140 core-state + 8 core-edit + 5 core-mode)
- `cargo clippy`: 0 warnings
- `cargo fmt`: clean
- All files ≤ 199 lines
- LIMITATIONS updated: 4 entries changed open→partial

## Limitations Updated

| ID | Old Status | New Status |
|---|---|---|
| LIM-MACROS-01 | `open` | `partial` |
| LIM-CMDCOMPL-01 | `open` | `partial` |
| LIM-CONFIG-01 | `open` | `partial` |
| LIM-RANGEPATTERN-01 | `open` | `partial` |
