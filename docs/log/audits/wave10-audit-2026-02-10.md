# Wave 10 Audit — 2026-02-10

## Summary

Wave 10 implements 8 features: yank marks, macro depth limit, count-based ranges,
expression register, last-inserted register, user command completion,
formatoptions, and config section headers.

## Tests

- 220 total tests (207 core-state + 5 core-edit + 8 findchar)
- 13 new tests: 10 wave10_tests + 3 expr_eval internal tests
- 0 failures
- 0 clippy warnings

## File Changes

### New files
- `expr_eval.rs` (~130 lines): Expression register evaluation with integer arithmetic, string literals, string concatenation
- `wave10_tests.rs` (~150 lines): 10 integration tests

### Modified files
- `editor.rs`: Added `macro_depth` and `last_inserted_text` fields
- `editor_modes.rs` (200): Store `.` register on Insert→Normal; fix duplicate `record_key` call; compress `compute_hlsearch`
- `editing_ops_yank.rs` (187): Set `[`/`]` marks in `yank_lines`
- `editing_ops_ranges.rs` (199): Mark setting already applied to Yank in `apply_charwise_op`
- `macros.rs` (119): Added depth limit (100) with `macro_depth` counter in `play_macro`
- `ex_parse_ranges.rs` (200): Added bare `+N`/`-N` offset address support
- `editing_ops_insert.rs`: Track inserted chars in `last_inserted_text`; clear on `enter_insert`
- `cmdline_completion.rs` (158): Include user-defined commands in completion candidates
- `format_ops.rs` (102): Check `formatoptions` for 'q' flag before gq formatting
- `options.rs` (160): Added `textwidth` and `formatoptions` defaults
- `config_loader.rs` (90): Support `[section]` headers and array `[a,b,c]` values
- `ex_scripting.rs` (200): Show `.` register in `:registers` display
- `lib.rs`: Registered `expr_eval` module and `wave10_tests`

## LIMITATIONS Updates

- LIM-MARKS-01: ` [ ] ` marks now set on yank operations
- LIM-MACROS-01: Recursive depth limit (100) implemented
- LIM-RANGEPATTERN-01: Bare +N/-N offset addresses support
- LIM-REGISTERS-01: Expression register (=) and last-inserted (.) register
- LIM-CMDCOMPL-01: User-defined command names included in Tab completion
- LIM-TEXTMANIP-01: formatoptions wired to gq behavior
- LIM-CONFIG-01: Section headers and array values in config files
